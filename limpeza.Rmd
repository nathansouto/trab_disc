---
title: "limpeza e analise dos dados"
output: pdf_document
---

##########################################################################################################
                                   DOCUMENTAÇÃO DOS DADOS
##########################################################################################################

  Attrition-Atrito = categórica (No Yes)
  Age-Idade = contínua (18 - 60)
  BusinessTravel-Viagem = categórica (non-travel travel_rarely travel_frequently)
  Department-Departamento = categórica (RH Research&Development Sales)
  DistanceFromHome-Distancia = numérica (1 - 29)
  Education-Educacao = numérica (1 - 5)
  EducationField-faculdade = categórica (RH Life_Sciences Marketing Medical Other Technical_Degree)
  EnvironmentSatisfaction-satisfacaoAmbiente = numérica (1 - 4)
  Gender-sexo = categórica (female male)
  JobLevel-Nivel = numérica (1 - 5)
  JobRole-Cargo = categórica (Healthcare_Representative RH Laboratory_Technician Manager Manufacturing_Director Research_Director Research_Scientist Sales_Executive Sales_Representative)
  JobSatisfaction-satisfacaotrab = numérica (1 - 4)
  MonthlyIncome-rendaMensal = numérica (1009 - 19999)
  PerformanceRating-desempenho = numérica (3 - 4)
  TotalWorkingYears-anosquetrabalha = numérica (0 - 40)
  YearsAtCompany-temponaempresa = numérica (0 - 40)
  YearsInCurrentRole-anosnafuncao = numérica (0 - 18)
  YearsSinceLastPromotion-anosultimapromocao = numérica (0 - 15)
  YearsWithCurrManager-anosatualgerente = numérica (0 - 17)
  JobInvolvement-Envolvimento = numérica (1 - 4)
  MaritalStatus-relacionamento = categórica (Divorced Married Single )
  NumCompaniesWorked-qtdEmpresaTrabalho = numérica (0 - 9)
  OverTime-horaExtra = categórica (No Yes)
  PercentSalaryHike-%aumentoSal = numérica (11 - 25)
  RelationshipSatisfaction-satisfacaorela = numérica (1 - 4)
  TrainingTimesLastYear-tempotreinamento = numérica (0 - 6)
  WorkLifeBalance-equilibrio = numérica (1 - 4)
	StockOptionLevel-ações = numérica (0 - 3)
	MonthlyRate-Taxa = numérica (2094 - 26999)
	HourlyRate-TaxaHoraria = numérica (30 - 100)
	EmployeeNumber-quantidadefuncionarios = numérica (1 - 2068)
	DailyRate-Diaria = numérica (102 1499)
  
  EmployeeCount-funcionarios = binária (1) só tem valores iguais a 1 ----------- coluna inútil
  StandardHours-horapadrao = numérica (80) ----------- coluna inútil
  Over18 = string (Y) ----------- coluna inútil
  
##########################################################################################################

##########################################################################################################

VARIÁVEIS NÃO-SUBJETIVAS E PEGANDO SOMENTE O MONTHLY INCOME (em salários)

##########################################################################################################

  Attrition-Atrito = categórica (No Yes)
  Age-Idade = contínua (18 - 60)
  BusinessTravel-Viagem = categórica (non-travel travel_rarely travel_frequently)
  Department-Departamento = categórica (RH Research&Development Sales)
  DistanceFromHome-Distancia = numérica (1 - 29)
  Education-Educacao = numérica (1 - 5)
  EducationField-faculdade = categórica (RH Life_Sciences Marketing Medical Other Technical_Degree)
  Gender-sexo = categórica (female male)
  JobLevel-Nivel = numérica (1 - 5)
  JobRole-Cargo = categórica (Healthcare_Representative RH Laboratory_Technician Manager Manufacturing_Director Research_Director Research_Scientist Sales_Executive Sales_Representative)
  MonthlyIncome-rendaMensal = numérica (1009 - 19999)
  TotalWorkingYears-anosquetrabalha = numérica (0 - 40)
  YearsAtCompany-temponaempresa = numérica (0 - 40)
  YearsInCurrentRole-anosnafuncao = numérica (0 - 18)
  YearsSinceLastPromotion-anosultimapromocao = numérica (0 - 15)
  YearsWithCurrManager-anosatualgerente = numérica (0 - 17)
  MaritalStatus-relacionamento = categórica (Divorced Married Single )
  NumCompaniesWorked-qtdEmpresaTrabalho = numérica (0 - 9)
  OverTime-horaExtra = categórica (No Yes)
  PercentSalaryHike-%aumentoSal = numérica (11 - 25)
  TrainingTimesLastYear-tempotreinamento = numérica (0 - 6)
  EmployeeNumber-quantidadefuncionarios = numérica (1 - 2068)


```{r}
library(tidyverse)
library(caret)

#ID3
require(rpart)
require(rpart.plot)
```

```{r}
dados <- read_csv("WA_Fn-UseC_-HR-Employee-Attrition.csv")
```

```{r}
summary(dados)

dados$Education[dados$Education == 1] <- "Bellow College"
dados$Education[dados$Education == 2] <- "College"
dados$Education[dados$Education == 3] <- "Bachelhor"
dados$Education[dados$Education == 4] <- "Master"
dados$Education[dados$Education == 5] <- "Doctor"

dados$EnvironmentSatisfaction[dados$EnvironmentSatisfaction == 1] <- "Low"
dados$EnvironmentSatisfaction[dados$EnvironmentSatisfaction == 2] <- "Medium"
dados$EnvironmentSatisfaction[dados$EnvironmentSatisfaction == 3] <- "High"
dados$EnvironmentSatisfaction[dados$EnvironmentSatisfaction == 4] <- "Very High"

dados$JobInvolvement[dados$JobInvolvement == 1] <- "Low"
dados$JobInvolvement[dados$JobInvolvement == 2] <- "Medium"
dados$JobInvolvement[dados$JobInvolvement == 3] <- "High"
dados$JobInvolvement[dados$JobInvolvement == 4] <- "Very High"

dados$JobSatisfaction[dados$JobSatisfaction == 1] <- "Low"
dados$JobSatisfaction[dados$JobSatisfaction == 2] <- "Medium"
dados$JobSatisfaction[dados$JobSatisfaction == 3] <- "High"
dados$JobSatisfaction[dados$JobSatisfaction == 4] <- "Very High"

dados$RelationshipSatisfaction[dados$RelationshipSatisfaction == 1] <- "Low"
dados$RelationshipSatisfaction[dados$RelationshipSatisfaction == 2] <- "Medium"
dados$RelationshipSatisfaction[dados$RelationshipSatisfaction == 3] <- "High"
dados$RelationshipSatisfaction[dados$RelationshipSatisfaction == 4] <- "Very High"

dados$PerformanceRating[dados$PerformanceRating == 1] <- "Low"
dados$PerformanceRating[dados$PerformanceRating == 2] <- "Good"
dados$PerformanceRating[dados$PerformanceRating == 3] <- "Excellent"
dados$PerformanceRating[dados$PerformanceRating == 4] <- "Very High"
```

```{r}
dados = dados %>%
  select(-c(EmployeeCount, Over18, StandardHours))

```

```{r}
dados %>%
  group_by(Attrition) %>%
  summarise(n = n()) %>%
  mutate(freq = n / sum(n)) 
```

Acho que pode ser uma tabela
```{r}
dados %>%
  group_by(Gender, Attrition) %>%
  summarise(n = n()) %>%
  mutate(freq = n / sum(n)) %>%
  ggplot(aes(x=Gender, fill=Attrition)) +
  geom_bar(size=3, position="dodge", aes(y = freq), stat = 'identity') +
  xlab("Atrito") +                             
  ylab("Frequência relativa") +                                  
  ggtitle("Frequência relativa das respostas de atrito por sexo")
```

```{r}
dados %>%
  group_by(JobRole, Attrition) %>%
  summarise(n = n()) %>%
  mutate(freq = n / sum(n)) %>%
  ggplot(aes(x=Attrition, fill=JobRole)) +
  geom_bar(size=3, position="dodge", aes(y = freq), stat = 'identity') +
  xlab("Atrito") +                             
  ylab("Frequência relativa") +                                  
  ggtitle("Frequência realtiva das respostas de atrito por cargo")
```

```{r}
dados %>%
ggplot(aes(x=Age, y=MonthlyIncome, col=Attrition)) +
  geom_point(size=3) +
  xlab("Idade") +                             
  ylab("Salário") +                                  
  ggtitle("Frequência das respostas de atrito por Salário e idade")
```

```{r}
dados %>%
ggplot(aes(x=DistanceFromHome, y=MonthlyIncome, col=Attrition)) +
  geom_point(size=2) +
  xlab("Idade") +                             
  ylab("Salário") +                                  
  ggtitle("Frequência das respostas de atrito por ")
```


### Separar o banco em duas parte, uma para treinar o modelo e o outro para testar o modelo

# Validação Hold-out

```{r}
dados$Attrition = factor(dados$Attrition, levels = c('No','Yes'))

set.seed(12345)

amostra <- sample(1:1470, (2/3)*1470)

train <- dados[amostra,]
test <- dados[-amostra,]

fit = rpart(formula = Attrition ~ ., method = 'class', data = train, parms = list(split = 'information')) #, control = repart.control(minsplit = 1, minbucket = 1, maxdepth = 25)

fit$variable.importance

fit$cptable
printcp(fit)
plotcp(fit)
```


```{r}
predict(fit, newdata = train, type = "class") %>%
  table(train$Attrition, .) %>%
  confusionMatrix()
```


```{r}
predict(fit, newdata = test, type = "class") %>%
  table(test$Attrition, .) %>%
  confusionMatrix()
```

```{r}
rpart.plot(fit, type=0, extra=101, box.palette="gray", branch.lty = 3, nn=TRUE, cex=0.5)
```